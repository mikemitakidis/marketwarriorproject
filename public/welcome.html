<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome - Market Warrior</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            min-height: 100vh;
            color: #f1f5f9;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding-top: 40px;
        }

        .logo {
            text-align: center;
            margin-bottom: 40px;
        }

        .logo-icon {
            font-size: 4em;
            display: block;
            margin-bottom: 15px;
        }

        .logo h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 24px;
            padding: 50px;
            backdrop-filter: blur(10px);
        }

        .welcome-card h2 {
            text-align: center;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .welcome-card .subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 40px;
            font-size: 1.1em;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #e2e8f0;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 15px 20px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            color: white;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255,255,255,0.1);
        }

        .form-group input::placeholder {
            color: #64748b;
        }

        .info-note {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.2);
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 30px;
            font-size: 0.9em;
            color: #94a3b8;
        }

        .info-note strong {
            color: #667eea;
        }

        .terms-section {
            background: rgba(255,255,255,0.03);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .terms-section h3 {
            color: white;
            margin-bottom: 20px;
            font-size: 1.2em;
        }

        .terms-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 0.9em;
            line-height: 1.8;
            color: #cbd5e1;
        }

        .terms-content h4 {
            color: #667eea;
            margin: 20px 0 10px 0;
        }

        .terms-content h4:first-child {
            margin-top: 0;
        }

        .terms-content ul {
            margin-left: 20px;
            margin-bottom: 15px;
        }

        .terms-content li {
            margin-bottom: 5px;
        }

        .checkbox-group {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            cursor: pointer;
        }

        .checkbox-group input {
            width: 22px;
            height: 22px;
            cursor: pointer;
            margin-top: 2px;
        }

        .checkbox-group label {
            color: #e2e8f0;
            cursor: pointer;
            line-height: 1.5;
        }

        .checkbox-group label a {
            color: #667eea;
            text-decoration: none;
        }

        .checkbox-group label a:hover {
            text-decoration: underline;
        }

        .btn-continue {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.2em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 20px;
        }

        .btn-continue:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn-continue:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #ef4444;
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
            font-size: 0.9em;
        }

        .error-message.show {
            display: block;
        }

        /* Custom scrollbar */
        .terms-content::-webkit-scrollbar {
            width: 8px;
        }

        .terms-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
            border-radius: 4px;
        }

        .terms-content::-webkit-scrollbar-thumb {
            background: rgba(102, 126, 234, 0.5);
            border-radius: 4px;
        }

        .terms-content::-webkit-scrollbar-thumb:hover {
            background: rgba(102, 126, 234, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">
            <span class="logo-icon">‚öîÔ∏è</span>
            <h1>Market Warrior</h1>
        </div>

        <div class="welcome-card">
            <h2>Welcome, Future Trader! üéâ</h2>
            <p class="subtitle">Let's set up your account and get you started</p>

            <div class="error-message" id="errorMessage"></div>

            <form id="welcomeForm" onsubmit="handleSubmit(event)">
                <div class="form-section">
                    <h3>üìù Your Information</h3>
                    <div class="form-group">
                        <label for="fullName">Full Name (as it will appear on your certificate)</label>
                        <input type="text" id="fullName" placeholder="Enter your full name" required>
                    </div>
                </div>

                <div class="info-note">
                    <strong>üìú Important:</strong> Please enter your name exactly as you want it to appear on your certificate of completion. This cannot be changed later without contacting support.
                </div>

                <div class="terms-section">
                    <h3>üìã Terms & Conditions</h3>
                    <div class="terms-content">
                        <h4>1. Educational Purpose Only</h4>
                        <p>Market Warrior is an educational platform designed to teach trading concepts and strategies. All content is for educational purposes only and should not be considered financial advice.</p>

                        <h4>2. No Guarantee of Results</h4>
                        <p>Trading involves significant risk. Past performance does not guarantee future results. You may lose some or all of your invested capital. Only trade with money you can afford to lose.</p>

                        <h4>3. Demo Trading First</h4>
                        <p>We strongly recommend practicing with a demo account for at least 6 months before trading with real money. This course is designed to be completed using virtual/demo trading only.</p>

                        <h4>4. Your Responsibilities</h4>
                        <ul>
                            <li>You are responsible for your own trading decisions</li>
                            <li>You agree to practice risk management at all times</li>
                            <li>You understand that Market Warrior is not a licensed financial advisor</li>
                            <li>You will not hold Market Warrior liable for any trading losses</li>
                        </ul>

                        <h4>5. Course Access</h4>
                        <ul>
                            <li>Access is granted for personal use only</li>
                            <li>Content may not be shared, copied, or redistributed</li>
                            <li>Days unlock progressively (one day every 24 hours)</li>
                            <li>You must complete quizzes and tasks to progress</li>
                        </ul>

                        <h4>6. Refund Policy</h4>
                        <p>Due to the digital nature of this course, refunds are available within 7 days of purchase if you have not completed more than 3 days of content.</p>

                        <h4>7. Privacy</h4>
                        <p>Your data is protected and will never be sold to third parties. We only use your information to provide the course and communicate important updates.</p>

                        <h4>8. Risk Disclosure</h4>
                        <p><strong>IMPORTANT:</strong> Trading foreign exchange, stocks, options, and other financial instruments carries a high level of risk and may not be suitable for all investors. The high degree of leverage can work against you as well as for you. Before deciding to trade, you should carefully consider your investment objectives, level of experience, and risk appetite.</p>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="agreeTerms" required>
                        <label for="agreeTerms">
                            I have read and agree to the <a href="/terms" target="_blank">Terms & Conditions</a> and <a href="/privacy" target="_blank">Privacy Policy</a>. I understand that trading involves risk and this course is for educational purposes only.
                        </label>
                    </div>
                </div>

                <div class="checkbox-group" style="margin-bottom: 20px;">
                    <input type="checkbox" id="agreeRisk" required>
                    <label for="agreeRisk">
                        I acknowledge that I am solely responsible for my trading decisions and will practice on a demo account before risking real money.
                    </label>
                </div>

                <button type="submit" class="btn-continue" id="continueBtn">Continue to Payment ‚Üí</button>
            </form>
        </div>
    </div>

    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://gvpaemdpmwyncdztlczy.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd2cGFlbWRwbXd5bmNkenRsY3p5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzM0MzQxNzUsImV4cCI6MjA0OTAxMDE3NX0.yrXU7tPwBSKnFP2NiT8uBzPdlmWNJMrhGv-PnE0PsKU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        let currentUser = null;

        // Check authentication
        document.addEventListener('DOMContentLoaded', async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                window.location.href = '/login';
                return;
            }

            currentUser = session.user;

            // Pre-fill name if available
            if (currentUser.user_metadata?.full_name) {
                document.getElementById('fullName').value = currentUser.user_metadata.full_name;
            }

            // Check if already completed welcome
            const { data: userData } = await supabase
                .from('users')
                .select('agreed_to_terms, payment_status')
                .eq('id', currentUser.id)
                .single();

            if (userData?.agreed_to_terms && userData?.payment_status === 'paid') {
                window.location.href = '/dashboard';
            }
        });

        async function handleSubmit(event) {
            event.preventDefault();

            const fullName = document.getElementById('fullName').value.trim();
            const agreeTerms = document.getElementById('agreeTerms').checked;
            const agreeRisk = document.getElementById('agreeRisk').checked;
            const continueBtn = document.getElementById('continueBtn');
            const errorMsg = document.getElementById('errorMessage');

            if (!fullName) {
                errorMsg.textContent = 'Please enter your full name';
                errorMsg.classList.add('show');
                return;
            }

            if (!agreeTerms || !agreeRisk) {
                errorMsg.textContent = 'Please agree to all terms to continue';
                errorMsg.classList.add('show');
                return;
            }

            errorMsg.classList.remove('show');
            continueBtn.disabled = true;
            continueBtn.textContent = 'Saving...';

            try {
                // Upsert user record
                const { error } = await supabase
                    .from('users')
                    .upsert({
                        id: currentUser.id,
                        email: currentUser.email,
                        full_name: fullName,
                        agreed_to_terms: true,
                        terms_agreed_at: new Date().toISOString(),
                        created_at: new Date().toISOString()
                    }, {
                        onConflict: 'id'
                    });

                if (error) throw error;

                // Store name for certificate
                localStorage.setItem('userName', fullName);

                // Redirect to payment/index page
                window.location.href = '/?checkout=true';

            } catch (error) {
                console.error('Save error:', error);
                errorMsg.textContent = error.message || 'Failed to save. Please try again.';
                errorMsg.classList.add('show');
                continueBtn.disabled = false;
                continueBtn.textContent = 'Continue to Payment ‚Üí';
            }
        }
    </script>
</body>
</html>
